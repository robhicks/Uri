var TinyUri=function(){"use strict";const t="undefined"!=typeof window?window.atob:t=>Buffer.from(t,"base64").toString("ascii"),e="undefined"!=typeof window?window.btoa:t=>Buffer.from(t,"ascii").toString("base64"),s=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,i=/^(.+\:.+@.+)/,r=/:(\d+)$/,h=/(\d+)$/,n=/^([^=]+)(?:=(.*))?$/,o=/\{\?(.*?)\}/;class l{constructor(t){this.string=t&&void 0!==t?String(t):String("")}toString(){return this.string}append(t){return this.string+=t,this}insert(t,e){this.string.length;let s=this.string.slice(0,t),i=this.string.slice(t);return this.string=s+e+i,this}}class c{constructor(t,e){return this.ctx=e,this.model=e.model,t&&this.set(t),this}get(){return this.model.authority}set(e){if(e===this.model.host)return this.ctx;const s=new l,r=e.split("@");if(console.log("s",r),this.model.user=r[0],i.test(e))s.append(e);else try{this.model.user=t(this.model.user),s.append(this.model.user).append("@").append(this.model.host),this.model.port&&s.append(":").append(this.model.port)}catch(t){}return this.model.authority=s.toString(),this.ctx}toString(t){return t?this.ctx.toString():this.model.user?(new l).append(e(this.model.user)).append("@").append(this.model.host):null}}class d{constructor(t,e){return this.ctx=e,this.model=e.model,t&&this.set(t),this}get(){return this.model.hash}set(t){let e=t.split("?");return e.length>0?this.model.hash="#"+e[0].replace(/#/,""):this.model.hash="#"+t.replace(/#/,""),this.ctx}toString(t){return t?this.ctx.toString():this.get()}}class p{constructor(t,e){return this.ctx=e,this.model=this.ctx.model,t&&this.set(t),this}get(){return this.model.host}set(t){const e=t.split("@");if(e.length>1){const t=e[1].split(":");t.length>0?this.model.host=t[0]:this.model.host=e[1]}else this.model.host=t;return this.ctx}toString(t){return t?this.ctx.toString():this.get()}}class u{constructor(t,e){return this.ctx=e,this.model=e.model,t&&this.set(t),this}get(){return this.model.fragment}set(t){this.model.hash&&(this.model.fragment=this.model.hash.replace(/#/,""))}toString(t){return t?this.ctx.toString():this.get()}}class a{constructor(t,e={}){return this.ctx=e,this.model=e.model,this.model.path=[],t&&this.parse(t),this}append(t){return this.model.path.push(t),this.ctx}delete(t){if(!t)return this.model.path.pop(),this.ctx}get(){return this.model.path}parse(t=""){let e=decodeURIComponent(t),s=e.split("/");Array.isArray(s)&&(e.match(/^\//)&&s.shift(),""===s[0]&&s.shift(),s.length>1&&e.match(/\/$/)&&s.pop(),this.model.path=s)}replace(t,e){return"file"===e?(this.model.path.splice(this.model.path.length-1,1,t),this.ctx):Number.isInteger(e)?(this.model.path.splice(e,1,t),this.ctx):(this.parse(t),this.ctx)}set(t){return this.parse(t),this.ctx}toString(t){return t?this.ctx.toString():Array.isArray(this.model.path)?this.model.path.join("/"):""}}class m{constructor(t,e){return this.ctx=e,this.model=this.ctx.model,t&&this.set(t),this}get(){return this.model.port}set(t){const e=isNaN(t)?t:String(t);let s=e.match(r),i=e.match(h);return s||i?(s&&s[1]?this.model.port=s[1]:i&&i[1]&&(this.model.port=i[1]),this.ctx):this.ctx}toString(t){return t?this.ctx.toString():this.get()}}class g{constructor(t,e={}){return this.ctx=e,this.model=e.model,this.set(t),this}add(t={}){return this.model.query=this._convert(t,this.model.query[0],this.model.query[1]),this.ctx}clear(){return this.model.query=[[],[]],this.ctx}_convert(t,e=[],s=[]){for(let i in t)if(Array.isArray(t[i]))for(let r=0;r<t[i].length;r++){let h=t[i][r];e.push(i),s.push(h)}else t[i]&&(e.push(i),s.push(t[i]));return[e,s]}get(){let t={},e=this.model.query;for(let s=0;s<e[0].length;s++){let i=e[0][s],r=e[1][s];t[i]?t[i].push(r):t[i]=[r]}return t}getUrlTemplateQuery(){return this._urlTemplateQueryString}merge(t){let e=this.model.query[0],s=this.model.query[1];for(let i in t){let r=!1;for(let h=0;h<e.length;h++){if(i===e[h]){if(r){e.splice(h,1),s.splice(h,1);continue}Array.isArray(t[i])?s[h]=t[i].shift():void 0===t[i]||null===t[i]?(e.splice(h,1),s.splice(h,1),delete t[i]):(s[h]=t[i],delete t[i]),r=!0}}}return this.model.query=this._convert(t,this.model.query[0],this.model.query[1]),this.ctx}_parse(t=""){let e=[[],[]],s=t.split(/&|;/);for(let t=0;t<s.length;t++){let i=s[t].match(n);if(i&&void 0!==i[i.length-1]){i.shift();for(let t=0;t<i.length;t++){let s=i[t];e[t].push(decodeURIComponent(s.replace("+"," ","g")))}}}return e}set(...t){let e=[...t];if(1===e.length)this.model.query="object"==typeof e[0]?this._convert(e[0]):this._parse(e[0]);else if(0===e.length)this.clear();else{let t={};t[e[0]]=e[1],this.merge(t)}return this.ctx}setUrlTemplateQuery(t){this._urlTemplateQueryString=t}toString(t){if(t)return this.ctx.toString();let e=[],s=this.model.query[0],i=this.model.query[1];for(let t=0;t<s.length;t++)e.push(encodeURIComponent(s[t])+"="+encodeURIComponent(i[t]));return e.join("&")}}class f{constructor(t,e){return this.ctx=e,this.model=e.model,this.set(t),this}get(){return this.model.scheme}set(t){const e=t.match(/^([a-z][a-z0-9+\-.]*):/);return e&&e[1]?this.model.scheme=e[1]:""===t||t.includes("/")||(this.model.scheme=t),this.ctx}toString(t){return t?this.ctx.toString():this.get()}}class y{constructor(t){return this.model={},this.parse(t)}parse(t){let e=t?t.match(s):[],i=t?t.match(o):[];return this.host=new p(e[4],this),this.port=new m(e[4],this),this.authority=new c(e[4],this),this.scheme=new f(t,this),this.protocol=this.scheme,this.path=new a(e[5]?e[5].replace(/{$/,""):"",this),this.userInfo=this.authority,this.hash=new d(e[9],this),this.fragment=new u(e[9],this),this.query=new g(e[7]?e[7]:"",this),i&&this.query.setUrlTemplateQuery(i[1]),this}toString(){const t=this.authority.toString(),e=this.hash.toString(),s=this.host.toString(),i=this.path.toString(),r=this.query.toString(),h=this.scheme.toString(),n=new l;return h&&(/mailto/.test(h)?n.append(h).append(":"):n.append(h).append(":").append("//")),t?n.append(t):s&&n.append(s),""!==i&&n.append("/").append(i),e&&n.append(e),""!==r&&n.append("?").append(r),n.toString()}static clone(t){return new y(t.toString())}}return y}();
