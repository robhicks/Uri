"use strict";var Path=function(t,r){void 0===r&&(r={}),Object.assign(this,r);var i=decodeURIComponent(t),e=i.split("/");return Array.isArray(e)&&(i.match(/^\//)&&e.shift(),e.length>1&&i.match(/\/$/)&&e.pop(),this._path=e),this};Path.prototype.toString=function(){return Array.isArray(this._path)?this._path.join("/"):""};var Query=function(t,r){return void 0===r&&(r={}),Object.assign(this,r),this.set(t),this};Query.prototype.add=function(t){return void 0===t&&(t={}),this._query=this._convert(t,this._query[0],this._query[1]),this},Query.prototype.clear=function(){return this._query=[[],[]],this},Query.prototype._convert=function(t,r,i){void 0===r&&(r=[]),void 0===i&&(i=[]);for(var e in t)if(Array.isArray(t[e]))for(var n=0;n<t[e].length;n++){var s=t[e][n];r.push(e),i.push(s)}else t[e]&&(r.push(e),i.push(t[e]));return[r,i]},Query.prototype.get=function(){for(var t={},r=this._query,i=0;i<r[0].length;i++){var e=r[0][i],n=r[1][i];t[e]?t[e].push(n):t[e]=[n]}return t},Query.prototype.merge=function(t){var r=this._query[0],i=this._query[1];for(var e in t)for(var n=!1,s=0;s<r.length;s++){var o=r[s];if(e===o){if(n){r.splice(s,1),i.splice(s,1);continue}Array.isArray(t[e])?i[s]=t[e].shift():void 0===t[e]||null===t[e]?(r.splice(s,1),i.splice(s,1),delete t[e]):(i[s]=t[e],delete t[e]),n=!0}}return this._query=this._convert(t,this._query[0],this._query[1]),this},Query.prototype._parse=function(t){for(var r=this,i=[[],[]],e=t.split(/&|;/),n=0;n<e.length;n++){var s=e[n],o=s.match(r.qRegEx);if(void 0!==o[o.length-1]){o.shift();for(var h=0;h<o.length;h++){var u=o[h];i[h].push(decodeURIComponent(u.replace("+"," ","g")))}}}return i},Query.prototype.set=function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];var i=[].concat(t);if(1===i.length)"object"==typeof i[0]?this._query=this._convert(i[0]):this._query=this._parse(i[0]);else if(0===i.length)this.clear();else{var e={};e[i[0]]=i[1],this.merge(e)}return this},Query.prototype.toString=function(){for(var t=[],r=this._query[0],i=this._query[1],e=0;e<r.length;e++)t.push(encodeURIComponent(r[e])+"="+encodeURIComponent(i[e]));return t.join("&")};var StringBuilder=function(t){this.string=t&&void 0!==t?String(t):String("")};StringBuilder.prototype.toString=function(){return this.string},StringBuilder.prototype.append=function(t){return this.string+=t,this},StringBuilder.prototype.insert=function(t,r){var i=(this.string.length,this.string.slice(0,t)),e=this.string.slice(t);return this.string=i+r+e,this};var Uri=function(t){return this.uriRegEx=/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,this.authRegEx=/^([^\@]+)\@/,this.portRegEx=/:(\d+)$/,this.qRegEx=/^([^=]+)(?:=(.*))?$/,this.parse(t)};Uri.prototype.authority=function(t){if(void 0===t&&(t=""),""!==t){var r=t.match(this.authRegEx);this._authority=t,r&&(t=t.replace(this.authRegEx,""),this.userInfo(r[1]));var i=t.match(this.portRegEx);return i&&(t=t.replace(this.portRegEx,""),this.port(i[1])),this.host(t),this}var e=this.userInfo();e&&(t=e+"@"),t+=this.host();var n=this.port();return n&&(t+=":"+n),t},Uri.prototype.fragment=function(t){return void 0===t&&(t=""),""!==t?this.gs(t,"_fragment"):this._fragment},Uri.prototype.gs=function(t,r,i){return void 0!==t?(this[r]=t,this):i?i(this[r]):this[r]},Uri.prototype.host=function(t){return t?this.gs(t,"_host"):this._host},Uri.prototype.parse=function(t){var r=t?t.match(this.uriRegEx):[];return this.path=new Path(r[5],this),this.scheme(r[2]),this.authority(r[4]),this.fragment(r[9]),this.query=new Query(r[7],this),this},Uri.prototype.port=function(t){return this.gs(t,"_port")},Uri.prototype.protocol=function(t){return this.scheme.toLowerCase()},Uri.prototype.scheme=function(t){return t?this.gs(t,"_scheme"):this._scheme},Uri.prototype.userInfo=function(t){return this.gs(t,"_userinfo",function(t){return t?encodeURI(t):t})},Uri.prototype.toString=function(){var t=this.query.toString(),r=this.path.toString(),i=(this.fragment(),this.scheme());return(new StringBuilder).append(i?i+"://":"").append(this.authority()).append("/").append(r).append("?").append(t).toString()},module.exports=Uri;
